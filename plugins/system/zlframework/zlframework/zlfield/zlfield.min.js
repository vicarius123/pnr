(function(b){var h=function(){};h.prototype=b.extend(h.prototype,{name:"ZLfield",options:{url:"",type:"",enviroment:""},initialize:function(c,f){this.options=b.extend({},this.options,f);var a=this;b("#toolbar-apply, #toolbar-save").click(function(){b(".zlfield input").each(function(){b(this).val()||b(this).remove()});return!0});b(document).ready(function(){b(".col-left ul.element-list").on("element.added",function(g,c){a.actions(b(c))});b("ul.ui-sortable").on("sortstop",function(g,c){var f=RegExp(/(elements\[[a-z0-9_-]+\])|(positions\[[a-z0-9_-]+\]\[[0-9]+\])/);
b("#assign-elements ul.element-list:not(.unassigned)").each(function(){var a="positions["+b(this).data("position")+"]";b(this).children().each(function(g){b(this).find("[data-control^=positions], [data-control^=elements]").each(function(){b(this).attr("data-control","tmp"+b(this).attr("data-control").replace(f,a+"["+g+"]"))})})});f=RegExp(/^tmp/);b("#assign-elements ul.element-list").find("[data-control^=tmp]").each(function(){b(this).attr("data-control",b(this).attr("data-control").replace(f,""))});
a.actions(c.item)});a.initActions()})},initActions:function(){var c=this,f=c.options.enviroment;("type-positions"==f||"type-edit"==f)&&b(".col-left ul.ui-sortable > li.element").each(function(){b(this).parent().trigger("sortstop",{item:b(this)})});"type-edit"==f&&b(".col-left .core-element-configuration .element-list > li.element").each(function(){c.actions(b(this))});"item-edit"==f&&b(".item-edit .creation-form .zlfield-main").each(function(){c.actions(b(this))});"module"==f&&b("form#module-form ul.adminformlist .zlfield-main").each(function(){b(this).parent("li").addClass("zlfield-module");
c.actions(b(this))});"app-config"==f&&b(".col-right .zlfield-main").each(function(){c.actions(b(this))})},actions:function(c){var f=this;c.data("zlfield-actions-init")||(c.find(".qTipHelp").each(function(){var a=b(this);a.qtip({overwrite:!1,content:{text:a.find(".qtip-content")},position:{my:"bottom center",at:"top center",viewport:b(window)},show:{solo:!0,delay:300},hide:{fixed:!0,delay:300},style:"ui-tooltip-light ui-tooltip-zlparam"})}),c.find(".zl-select-expand").each(function(){var a=b(this);
a.click(function(){b(this).prev().height(150);b(this).remove()}).qtip({overwrite:!1,content:{text:a.data("zl-qtip")},position:{at:"right top",my:"left bottom"},show:{solo:!0,delay:600},hide:{delay:0},style:"ui-tooltip-light ui-tooltip-zlparam"})}),b("#toolbar-apply, #toolbar-save").on("mousedown",function(){c.find(".row[data-type=password] .zl-field input").each(function(){b(this).val("zl-decrypted["+b(this).val()+"]")})}),c.find(".zl-state").each(function(){var a=b(this).find("input"),g=a.closest(".row");
a.bind("change",function(){"checked"==b(this).attr("checked")?(g.removeClass("zl-disabled"),g.find(".zl-field").children().removeAttr("disabled")):(g.addClass("zl-disabled"),g.find(".zl-field").children().attr("disabled",!0))})}),c.find(".zl-state input").each(function(){var a=b(this);a.qtip({content:{text:"Override this field"},position:{at:"left top",my:"right bottom",effect:!1},show:{target:a.closest(".row"),solo:!0,delay:200},hide:{target:a.closest(".row"),delay:0},style:"ui-tooltip-light ui-tooltip-zlparam",
events:{show:function(b,c){"checked"==a.attr("checked")&&b.preventDefault();a.bind("change",function(){c.hide()});c.set("content.text",a.parent().attr("tooltip"))}}})}),c.find(".zltoggle-btn").each(function(){var a=b(this),c=a.next();a.find(".tg-open").bind("click",function(){a.toggleClass("open")&&c.show()});a.find(".tg-close").bind("click",function(){a.toggleClass("open")&&c.hide()})}),c.find("[data-dependents]").each(function(){var a=b(this),c=a.data("dependents").replace(/ /g,"").split("|"),f=
a.closest(".zlfield.placeholder .wrapper, .zlfield.placeholder").first();c.each(function(c){var g=c.split("!>"),j=2==g.length?"!>":">",g=">"==j?c.split(">"):g;d=g[0].split(",");e=g[1].replace("NONE","");("select"==a.data("type")||"itemLayoutList"==a.data("type")||"layout"==a.data("type")||"apps"==a.data("type")||"types"==a.data("type")||"elements"==a.data("type")||"modulelist"==a.data("type")||"separatedby"==a.data("type"))&&d.each(function(c){var g=f.find('[data-id="'+c+'"]').data("e",e).data("m",
j).hide();a.find(".zl-field select").bind("change",function(){var a=g.data("e"),c=g.data("m"),f=b.makeArray(b(this).val()),j=0;a&&a.match(/OR/g)?b.each(f,function(b,g){var f=RegExp(g,"g");("!>"==c&&!a.match(f)||">"==c&&a.match(f))&&(j=1)}):(a&&a.match(/AND/g),b.each(f,function(b,f){("!>"==c&&f!=a||">"==c&&f==a)&&(j=1)}));j&&g.slideDown("fast")||g.slideUp("fast")}).trigger("change")});"checkbox"==a.data("type")&&d.each(function(c){var g=f.find('[data-id="'+c+'"]').hide();a.find(".zl-field input").bind("change",
function(){var a="checked"==b(this).attr("checked");("!>"==j&&!a||">"==j&&a)&&g.slideDown("fast")||g.slideUp("fast")}).trigger("change")});"radio"==a.data("type")&&d.each(function(c){var g=e,h=f.find('[data-id="'+c+'"]').hide();a.find(".zl-field input").bind("change",function(){var a="checked"==b(this).attr("checked"),c=0,f=b(this).attr("value");a&&(g&&g.match(/OR/g)?(a=RegExp(f,"g"),("!>"==j&&!g.match(a)||">"==j&&g.match(a))&&(c=1)):("!>"==j&&f!=g&&a||">"==j&&(f==g&&a)&&a)&&(c=1),c&&h.slideDown("fast")||
h.slideUp("fast"))}).trigger("change")});"text"==a.data("type")&&d.each(function(c){var g=f.find('[data-id="'+c+'"]').hide();a.find(".zl-field input").on("keyup change",function(){var a=""!=b(this).val();("!>"==j&&!a||">"==j&&a)&&g.slideDown("fast")||g.slideUp("fast")}).trigger("change")})})}),c.find("[data-relieson]").each(function(){var a=b(this),c=a.data("relieson"),h=a.parents(".placeholder").find('[data-id="'+c.id+'"]').find("select");h.on("change",function(){var m=b(this).val()?b(this).val():
"",k=b(this).closest(".zl-field"),j=c.json,n=a.attr("data-control"),p=b(this).closest(".zlfield-main").attr("data-ajaxargs"),l=c.psv,q=c.id;l[c.id]=m;k.append(b('<span class="activity zl-loader">'));b.getJSON(c.url,{task:"loadfield",json:j,ctrl:n,psv:l,pid:q,node:null,args:p,ajaxcall:!0,enviroment:f.options.enviroment},function(b){k.find(".activity").remove();a.slideUp("fast",function(){a.empty();b&&b.result&&a.html('<div class="loaded-fields">'+b.result+"</div>");f.actions(a.find("> .loaded-fields"));
a.slideDown("fast");h.trigger("loaded.zlfield")})})})}),c.find(".load-field-btn").on("click",function(a){a.preventDefault();a=b(this);var c=a.parent(".zlfield-main"),h=c.data("ajaxargs");a.find("span").addClass("zlux-loader-raw");b.ajax({url:f.options.url,type:"POST",data:{task:"loadZLfield",group:h.group,type:f.options.type,control_name:h.control_name,json_path:h.json_path,element_id:h.element_id,element_type:h.element_type,enviroment:h.enviroment,node:h.node},success:function(a){a=b.parseJSON(a);
c.fadeOut("fast",function(){b(this).html(a.result);f.actions(c);c.fadeIn("slow")})}})}),c.data("zlfield-actions-init",!0))}});b.fn[h.prototype.name]=function(){var c=arguments,f=c[0]?c[0]:null;return this.each(function(){var a=b(this);if(h.prototype[f]&&a.data(h.prototype.name)&&"initialize"!=f)a.data(h.prototype.name)[f].apply(a.data(h.prototype.name),Array.prototype.slice.call(c,1));else if(!f||b.isPlainObject(f)){var g=new h;h.prototype.initialize&&g.initialize.apply(g,b.merge([a],c));a.data(h.prototype.name,
g)}else b.error("Method "+f+" does not exist on jQuery."+h.name)})}})(jQuery);